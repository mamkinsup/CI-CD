### Part 1. Настройка **gitlab-runner**

##### Подними виртуальную машину *Ubuntu Server 22.04 LTS*.

##### Скачай и установи на виртуальную машину **gitlab-runner**.

- Устанавливаем gitlab-runner

![cicd](pic/1.1.png)

![cicd](pic/1.2.png)

##### Запусти **gitlab-runner** и зарегистрируй его для использования в текущем проекте (*DO6_CICD*).
- Запускаем и регистрируем gitlab-runner по токену и URL с платформы к этому заданию
![cicd](pic/1.3.png)

### Part 2. Сборка

#### Напиши этап для **CI** по сборке приложений из проекта *C2_SimpleBashUtils*.

##### В файле _gitlab-ci.yml_ добавь этап запуска сборки через мейк файл из проекта _C2_.

- Копируем папки из проекта C2_SimpleBashUtils, в _.gitlab-ci.yml_ указываем путь до makefile:

- В ``stages:`` уже есть ``build``

![cicd](pic/2.1.png)

![cicd](pic/2.2.png)


### Part 3. Тест кодстайла

#### Напиши этап для **CI**, который запускает скрипт кодстайла (*clang-format*).

- В ``stages:`` добаволяем ``-style``
 ![cicd](pic/3.1.png)

- Если кодстайл прошел

 ![cicd](pic/3.2.png)

##### Если кодстайл не прошел, то «зафейли» пайплайн.

 ![cicd](pic/3.3.png)

##### В пайплайне отобрази вывод утилиты *clang-format*.


### Part 4. Интеграционные тесты

#### Напиши этап для **CI**, который запускает твои интеграционные тесты из того же проекта.

- В ``stages:`` добаволяем ``-test``

 ![cicd](pic/4.1.png)

##### Запусти этот этап автоматически только при условии, если сборка и тест кодстайла прошли успешно.

 - Последующие стадии автоматически пропускается, если предыдущие зафейлены

##### Если тесты не прошли, то «зафейли» пайплайн.

 ![cicd](pic/4.2.2.png)

##### В пайплайне отобрази вывод, что интеграционные тесты успешно прошли / провалились.

 ![cicd](pic/4.2.png)
 ![cicd](pic/4.2.1.png)

### Part 5. Этап деплоя

##### Подними вторую виртуальную машину *Ubuntu Server 22.04 LTS*.

 ![cicd](pic/5.1.1.png)

#### Напиши этап для **CD**, который «разворачивает» проект на другой виртуальной машине.

- Устанавливаем сетевые адаптеры "сетевой мост"

![cicd](pic/5.1.png)

- C помощью команды ``sudo su gitlab-ranner``  переключаемся на пользователя gitlab-ranner. Генерируем ssh ключю
- При помощи команды ``ssh-copy-id <имя_пользователя>@<публичный_IP-адрес_ВМ>`` устанавливаем соединение со 2й машиной
- Для пользователя 2й ВМ выполняем команду ``chown <имя_пользователя> /usr/local/bin``, чтобы пользователь стал владельцом директории и не возникало ошибок с доступом при копировании файлов

##### Запусти этот этап вручную при условии, что все предыдущие этапы прошли успешно.

![cicd](pic/5.4.png)

##### Напиши bash-скрипт, который при помощи **ssh** и **scp** копирует файлы, полученные после сборки (артефакты), в директорию */usr/local/bin* второй виртуальной машины.

 ![cicd](pic/5.2.1.png)

##### В файле _gitlab-ci.yml_ добавь этап запуска написанного скрипта.

 ![cicd](pic/5.2.png)

##### В случае ошибки «зафейли» пайплайн.

 ![cicd](pic/5.3.1.png)

В результате ты должен получить готовые к работе приложения из проекта *C2_SimpleBashUtils* (s21_cat и s21_grep) на второй виртуальной машине.

 ![cicd](pic/5.3.png)
 ![cicd](pic/5.4.png)
 ![cicd](pic/5.5.png)



### Part 6. Дополнительно. Уведомления

##### Настрой уведомления о успешном/неуспешном выполнении пайплайна через бота с именем «[твой nickname] DO6 CI/CD» в *Telegram*.

- Создаем бота в Телеграм с помощью BotFather:
![cicd](pic/6.0.png)

- Далее создадим скрипт telega.sh:
 ![cicd](pic/6.2.png)

- Добавляем в ``stages:`` добаволяем ``telega``
 ![cicd](pic/6.1.png)

- Проверяем 
 ![cicd](pic/6.3.png)